{
    "category": "Vector Comprehensions",
    "tests": [
        {
            "id": "comp_001",
            "input": "{x for x in 1..5}",
            "expected": [
                1,
                2,
                3,
                4,
                5
            ],
            "expectedType": "NodeVector",
            "notes": "Basic comprehension over range"
        },
        {
            "id": "comp_002",
            "input": "{x * 2 for x in 1..5}",
            "expected": [
                2,
                4,
                6,
                8,
                10
            ],
            "expectedType": "NodeVector",
            "notes": "Comprehension with transformation"
        },
        {
            "id": "comp_003",
            "input": "{x^2 for x in 1..5}",
            "expected": [
                1,
                4,
                9,
                16,
                25
            ],
            "expectedType": "NodeVector",
            "notes": "Comprehension with squaring"
        },
        {
            "id": "comp_004",
            "input": "{x for x in 0..10 if x mod 2 == 0}",
            "expected": [
                0,
                2,
                4,
                6,
                8,
                10
            ],
            "expectedType": "NodeVector",
            "notes": "Comprehension with filter (even numbers)"
        },
        {
            "id": "comp_005",
            "input": "{x for x in 1..10 if x mod 2 == 1}",
            "expected": [
                1,
                3,
                5,
                7,
                9
            ],
            "expectedType": "NodeVector",
            "notes": "Comprehension with filter (odd numbers)"
        },
        {
            "id": "comp_006",
            "input": "{x * x for x in 1..5 if x > 2}",
            "expected": [
                9,
                16,
                25
            ],
            "expectedType": "NodeVector",
            "notes": "Comprehension with transformation and filter"
        },
        {
            "id": "comp_007",
            "input": "{x + 10 for x in 5..8}",
            "expected": [
                15,
                16,
                17,
                18
            ],
            "expectedType": "NodeVector",
            "notes": "Comprehension with addition"
        },
        {
            "id": "comp_008",
            "input": "{x for x in {1, 2, 3, 4}}",
            "expected": [
                1,
                2,
                3,
                4
            ],
            "expectedType": "NodeVector",
            "notes": "Comprehension over vector literal"
        },
        {
            "id": "comp_009",
            "input": "{x * 3 for x in {2, 4, 6}}",
            "expected": [
                6,
                12,
                18
            ],
            "expectedType": "NodeVector",
            "notes": "Comprehension over vector with transformation"
        },
        {
            "id": "comp_010",
            "input": "{x for x in {10, 20, 30} if x >= 20}",
            "expected": [
                20,
                30
            ],
            "expectedType": "NodeVector",
            "notes": "Comprehension over vector with filter"
        },
        {
            "id": "comp_011",
            "input": "sum({x for x in 1..10})",
            "expected": 55.0,
            "expectedType": "NodeRational",
            "notes": "Comprehension result used in function"
        },
        {
            "id": "comp_012",
            "input": "sum({x^2 for x in 1..5})",
            "expected": 55.0,
            "expectedType": "NodeDouble",
            "notes": "Sum of squares via comprehension"
        },
        {
            "id": "comp_013",
            "input": "{-x for x in 1..5}",
            "expected": [
                -1,
                -2,
                -3,
                -4,
                -5
            ],
            "expectedType": "NodeVector",
            "notes": "Comprehension with negation"
        },
        {
            "id": "comp_014",
            "input": "{if(x mod 2 == 0, x, x * 2) for x in 1..5}",
            "expected": [
                2,
                2,
                6,
                4,
                10
            ],
            "expectedType": "NodeVector",
            "notes": "Comprehension with conditional transformation"
        },
        {
            "id": "comp_015",
            "input": "length({x for x in 1..100 if x mod 10 == 0})",
            "expected": 10.0,
            "expectedType": "NodeRational",
            "notes": "Count filtered results"
        },
        {
            "id": "comp_016",
            "input": "{2*x + 1 for x in 1..4}",
            "expected": [
                3,
                5,
                7,
                9
            ],
            "expectedType": "NodeVector",
            "notes": "Comprehension with complex expression"
        },
        {
            "id": "comp_017",
            "input": "{x for x in {}}",
            "expected": [],
            "expectedType": "NodeVector",
            "notes": "Comprehension over empty vector"
        },
        {
            "id": "comp_018",
            "input": "{x for x in 1..20 if x mod 3 == 0 && x mod 5 == 0}",
            "expected": [
                15
            ],
            "expectedType": "NodeVector",
            "notes": "Comprehension with complex condition (multiples of 15)"
        },
        {
            "id": "comp_019",
            "input": "{x for x in 1..5 if x > 10}",
            "expected": [],
            "expectedType": "NodeVector",
            "notes": "Comprehension with condition filtering all elements"
        },
        {
            "id": "comp_020",
            "input": "{sin(x) for x in {0, pi/2, pi}}",
            "expected": [
                0,
                1,
                0
            ],
            "expectedType": "NodeVector",
            "notes": "Comprehension with builtin function (sin) in radians"
        },
        {
            "id": "comp_021",
            "input": "{abs(x) for x in {-1, 2, -3, 4}}",
            "expected": [
                1,
                2,
                3,
                4
            ],
            "expectedType": "NodeVector",
            "notes": "Comprehension with abs function"
        },
        {
            "id": "comp_022",
            "input": "{x for x in 1..10 step 2}",
            "expected": [
                1,
                3,
                5,
                7,
                9
            ],
            "expectedType": "NodeVector",
            "notes": "Comprehension with range step"
        },
        {
            "id": "comp_023",
            "input": "{x for x in 10..1 step -1}",
            "expected": [
                10,
                9,
                8,
                7,
                6,
                5,
                4,
                3,
                2,
                1
            ],
            "expectedType": "NodeVector",
            "notes": "Comprehension with descending range"
        },
        {
            "id": "comp_024",
            "input": "{x for x in 0..1 step 0.25}",
            "expected": [
                0,
                0.25,
                0.5,
                0.75,
                1.0
            ],
            "expectedType": "NodeVector",
            "notes": "Comprehension with decimal range"
        },
        {
            "id": "comp_025",
            "input": "{x for x in 1..100000 if x > 99995}",
            "expected": [
                99996,
                99997,
                99998,
                99999,
                100000
            ],
            "expectedType": "NodeVector",
            "notes": "Lazy iteration over large range with filter"
        },
        {
            "id": "comp_026",
            "input": "sum({x for x in 1..100})",
            "expected": 5050.0,
            "expectedType": "NodeRational",
            "notes": "Sum of comprehension over range 1..100"
        },
        {
            "id": "comp_027",
            "input": "x := 100; v := {x for x in 1..3}; x",
            "expected": 100.0,
            "expectedType": "NodeRational",
            "notes": "Comprehension variable is local and doesn't affect global"
        },
        {
            "id": "comp_028",
            "input": "offset := 10; {x + offset for x in 1..3}",
            "expected": [
                11,
                12,
                13
            ],
            "expectedType": "NodeVector",
            "notes": "Comprehension can access global variables"
        },
        {
            "id": "comp_029",
            "input": "square(x) := x^2; {square(x) for x in 1..5}",
            "expected": [
                1,
                4,
                9,
                16,
                25
            ],
            "expectedType": "NodeVector",
            "notes": "Comprehension with user-defined function"
        },
        {
            "id": "comp_030",
            "input": "{{x + y for y in 1..2} for x in 1..2}",
            "expected": "{{2, 3}, {3, 4}}",
            "expectedType": "NodeVector",
            "notes": "Nested comprehension"
        },
        {
            "id": "comp_031",
            "input": "{sum(v) for v in {{1, 2}, {3, 4}, {5, 6}}}",
            "expected": [
                3,
                7,
                11
            ],
            "expectedType": "NodeVector",
            "notes": "Comprehension of comprehension with sum"
        },
        {
            "id": "comp_032",
            "input": "max({x for x in 1..10})",
            "expected": 10.0,
            "expectedType": "NodeDouble",
            "notes": "Comprehension in function call (max)"
        },
        {
            "id": "comp_033",
            "input": "{v[0] for v in {{1, 2}, {3, 4}, {5, 6}}}",
            "expected": [
                1,
                3,
                5
            ],
            "expectedType": "NodeVector",
            "notes": "Comprehension with subscript access"
        },
        {
            "id": "comp_034",
            "input": "squares := {x^2 for x in 1..5}; squares",
            "expected": [
                1,
                4,
                9,
                16,
                25
            ],
            "expectedType": "NodeVector",
            "notes": "Comprehension assigned to variable"
        },
        {
            "id": "comp_err_001",
            "input": "{x for x in 42}",
            "expectError": true,
            "expectedErrorType": "TypeError",
            "notes": "Cannot iterate over number"
        },
        {
            "id": "comp_err_002",
            "input": "{x for x in \"hello\"}",
            "expectError": true,
            "expectedErrorType": "TypeError",
            "notes": "Cannot iterate over string (not implemented)"
        }
    ]
}
